<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_packingslip_custom" inherit_id="stock.report_delivery_document">
       <xpath expr="//div[@class='page']/h2" position="replace">
           <h2 class="mt-3" style="color: #374283;">
                Packing Slip
           </h2>
           <h2>
               <span t-field="o.name" />
           </h2>
       </xpath>
       <xpath expr="//div[@class='row mt32 mb32']" position="replace">
           <div class="row mt32 mb32">
                <div t-if="o.origin" class="col-3" name="div_origin">
                    <strong>Order:</strong>
                    <p t-field="o.origin"/>
                </div>
                <div t-if="o.state" class="col-3" name="div_sched_date">
                    <strong>Shipping Date:</strong>
                    <t t-if="o.state == 'done'">
                        <p t-field="o.date_done"/>
                    </t>
                    <t t-if="o.state != 'done'">
                        <p t-field="o.scheduled_date"/>
                   </t>
                </div>
               <div t-if="o.sale_id.contract_name" class="col-3" name="div_contract_name">
                   <strong>Contract:</strong>
                   <t t-if="o.sale_id.contract_name">
                       <p t-field="o.sale_id.contract_name" />
                   </t>
               </div>
                <div t-if="o.sale_id.client_order_ref" class="col-4" name="div_client_order_ref">
                    <strong>Customer Reference: </strong>
                    <t t-if="o.sale_id.client_order_ref" >
                        <p t-field="o.sale_id.client_order_ref" />
                    </t>
                </div>
           </div>
       </xpath>
       <xpath expr="//th[@name='th_sm_quantity']" position="replace">
           <th name="th_sm_quantity"><strong>Qty Shipped</strong></th>
       </xpath>
       <xpath expr="//table//tbody//tr//td[1]" position="replace">
           <td>
                <span t-field="move.product_id"/><br/>
                <p t-if="move.product_id.nsn">
                    <span>NSN: <span t-field="move.product_id.nsn" /></span>
                </p>
                <p t-if="move.description_picking != move.product_id.name and move.description_picking != move.product_id.display_name">
                    <span t-field="move.description_picking"/>
                </p>
           </td>
       </xpath>
        <xpath expr="//th[@name='th_sml_quantity']" position="before">
            <th name="th_sml_qty_ordered" class="text-center" t-if="has_serial_number">
                <strong>Ordered</strong>
            </th>
        </xpath>
       <xpath expr="//th[@name='th_sml_product']" position="after">
           <th name="th_sml_product_conditions" t-if="has_serial_number"><strong>CND</strong></th>
       </xpath>
       <xpath expr="//th[@name='th_sml_quantity']" position="replace">
            <th name="th_sml_quantity" class="text-center"><strong>Qty Shipped</strong></th>
       </xpath>
       <xpath expr="//t[@t-if='o.backorder_ids and backorders']/p" position="replace" />
       <xpath expr="//table[@name='stock_backorder_table']" position="replace">
<!--           <tbody>-->
<!--                <t t-foreach="backorders" t-as="backorder">-->
<!--                    <t t-set="bo_lines" t-value="backorder.move_lines.filtered(lambda x: x.product_uom_qty)"/>-->
<!--                    <tr t-foreach="bo_lines" t-as="bo_line">-->
<!--                        <td class="w-auto">-->
<!--                            <span t-field="bo_line.product_id"/>-->
<!--                            <p t-if="bo_line.description_picking != bo_line.product_id.name and bo_line.description_picking != bo_line.product_id.display_name">-->
<!--                                <span t-field="bo_line.description_picking"/>-->
<!--                            </p><br/>-->
<!--                            <span>NSN:<span t-field="bo_line.product_id.nsn" /></span>-->
<!--                        </td>-->
<!--                        <td/>-->
<!--                        <td class="text-center w-auto">-->
<!--                            <span t-field="bo_line.product_uom_qty"/>-->
<!--                            <span t-field="bo_line.product_uom"/>-->
<!--                        </td>-->
<!--                    </tr>-->
<!--                </t>-->
<!--           </tbody>-->
       </xpath>
    </template>

    <template id="stock_with_serial_move" inherit_id="stock.stock_report_delivery_has_serial_move_line">
        <xpath expr="//td[1]" position="replace">
            <td>
                <span t-field="move_line.product_id"/>
                <t t-if="not description and description != ''">
                    <t t-set="description" t-value="move_line.move_id.description_picking"/>
                </t>
                <p t-if="description !='' and description != move_line.product_id.name">
                    <span t-esc="description"/>
                </p><br/>
                <span>NSN: <span t-field="move_line.product_id.nsn" /></span>
            </td>
        </xpath>
        <xpath expr="//td[1]" position="after">
            <td>
                <span t-field="move_line.product_id.product_conditions.code" />
            </td>
        </xpath>
         <xpath expr="//td[@name='move_line_lot_qty_done']" position="before">
                <td class="text-center">
                <span t-field="move_line.move_id.sale_line_id.product_uom_qty"/>
                <span t-field="move_line.product_uom_id"/>
            </td>
        </xpath>
    </template>
</odoo>

